<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>ShowMessages</title>
    <script type="text/javascript" src="__PUBLIC__/js/jquery-2.2.4.min.js"></script>
</head>
<style type="text/css">
    table.gridtable {
        width: 100%;
        font-family: verdana,arial,sans-serif;
        font-size:11px;
        color:#333333;
        border-width: 1px;
        border-color: #666666;
        border-collapse: collapse;
    }
    table.gridtable th {
        border-width: 1px;
        padding: 8px;
        border-style: solid;
        border-color: #666666;
        background-color: #dedede;
    }
    table.gridtable td {
        border-width: 1px;
        padding: 8px;
        border-style: solid;
        border-color: #666666;
        background-color: #ffffff;
    }
    table.gridtable textarea {
        width: 100%;
        font-family: verdana,arial,sans-serif;
        font-size:31px;
        color:#333333;
        background-color: #ffffff;
    }
    .checkbox {
        width: 19px;
        height: 25px;
        padding: 0 5px 0 0;
        /*display: block;*/
        /*clear: left;*/
        /*float: left;*/
    }
    .checkbox2 {
        width: 35px;
        height: 30px;
        padding: 0 5px 0 0;
        /*display: block;*/
        /*clear: left;*/
        /*float: left;*/
    }
    .checkbox3 {
        width: 19px;
        height: 25px;
        padding: 0 5px 0 0;
        /*display: block;*/
        /*clear: left;*/
        /*float: left;*/
    }
    .lable1{
        margin-right: 5%;
    }
    .lable2{
    }
</style>
<body>


        <span style="font-size: 25px">您好 <i>{$username}！</i></span>
        <a href="__ROOT__/Views/StaffsLogin/logout" style="float: right;font-size: 15px">登出</a>



    <form action="{:U('Views/DisplayMessages/check')}?id={$id}" method="post">
        <table class="gridtable" style="font-size: 25px">
            <thead>
            <tr>
                <th>id</th>
                <th>标题</th>
                <th>记录时间</th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td>{$data['id']}</td>
                <td>{$data['title']}</td>
                <td>{$data['record_time']}</td>
            </tr>
            <th colspan="3">内容</th>
            <tr>
                <td colspan="3" align="center">
                    <textarea  rows="5" style=" overflow:visible;" name="content" id="content_id">{$data['content']}</textarea>
                </td>
            </tr>
            <tr>
                <td colspan="3">
                    <fieldset>
                        <legend>运费筛选(未启用)</legend>
                        <div id="phone_number" style="display: none">{$data['phone_number']}</div>
                        <div id="area_start_select">起始地:</div><input type="text" name="area_start" id="area_start_text" placeholder="起始地">
                        <div id="area_end_select">终止地:</div><input type="text" name="area_end" id="area_end_text" placeholder="终止地">
                        <div id="freight">运费:</div><input type="number" name="freight" id="freight_text" placeholder="运费">
                        <button type="button" id="freight_submit">提交</button>
                    </fieldset>
                </td>
            </tr>
            </tbody>
        </table>

        <!--<form id="formid1" onsubmit="alert(this.test.value);return false;">-->

        <!--</form>-->
        <div style="text-align: center;margin-top: 20px;margin-bottom: 20px">
            <input type="button" id="Button1" name="Button1" onclick="delete_confirm()" value="删除" style="width:10%;height: 30px"><br/>
        </div>

        <!--删除按钮-->
        <div style="text-align: center;margin-top: 20px;margin-bottom: 20px">
            <input type="button" id="Button2" name="Button2" onclick="all_choose(this)" value="全选" style="width:10%;height: 30px">
        </div>

        <!--标签复选框-->
        <fieldset style="font-size: 30px">
            <legend>选择标签</legend>
            <label class="label1" style="margin-right: 5%"><input type="checkbox" name="tag[]" value="求购" class="checkbox2"/>求购</label>
            <label class="label1" style="margin-right: 5%"><input type="checkbox" name="tag[]" value="供应" class="checkbox2"/>供应</label>
            <label class="label1" style="margin-right: 5%"><input type="checkbox" name="tag[]" value="找车" class="checkbox2"/>找车</label>
            <label class="label1" style="margin-right: 5%"><input type="checkbox" name="tag[]" value="车源" class="checkbox2"/>车源</label>
            <label class="label1" style="margin-right: 5%"><input type="checkbox" name="tag[]" value="其他" class="checkbox2"/>其他</label><br/><br/>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="陕西" class="checkbox"/>陕西</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="山西" class="checkbox"/>山西</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="河北" class="checkbox"/>河北</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="北京" class="checkbox"/>北京</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="天津" class="checkbox"/>天津</label><br/>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="河南" class="checkbox"/>河南</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="山东" class="checkbox"/>山东</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="江苏" class="checkbox"/>江苏</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="安徽" class="checkbox"/>安徽</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="湖北" class="checkbox"/>湖北</label><br/>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="湖南" class="checkbox"/>湖南</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="四川" class="checkbox"/>四川</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="重庆" class="checkbox"/>重庆</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="云南" class="checkbox"/>云南</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="贵州" class="checkbox"/>贵州</label><br/>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="西部" class="checkbox"/>西部</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="东北" class="checkbox"/>东北</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="南方" class="checkbox"/>南方</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="内蒙古" class="checkbox"/>内蒙古</label>
            <br/><br/>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="二手车" class="checkbox3"/>二手车</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="招聘求职" class="checkbox3"/>招聘求职</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="运费咨询" class="checkbox3"/>运费咨询</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="咨询" class="checkbox3"/>咨询</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="设备" class="checkbox3"/>设备</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="托盘" class="checkbox3"/>托盘</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="车源找货" class="checkbox3"/>车源找货</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="发票" class="checkbox3"/>发票</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="保险" class="checkbox3"/>保险</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="承兑" class="checkbox3"/>承兑</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="求助" class="checkbox3"/>求助</label>
            <label style="margin-right: 10%"><input type="checkbox" name="tag[]" value="贷款" class="checkbox3"/>贷款</label>

        </fieldset>
            <center><input type="submit" name="submit" value="提交" style="width: 30%;height: 50px;margin-top: 20px"/></center>
    </form>
    <div align="center" style="margin-top: 3%">
        <input type="button" value="上一条" id="prevM" name="prevM" onclick="location.href='{$prev}'"  style="width: 30%;flex: auto;margin-bottom: 20px;height: 50px"/>
        <input type="button" value="下一条" id="nextM" name="nextM" onclick="location.href='{$next}'"  style="width: 30%;flex: auto;margin-bottom: 20px;height: 50px"/>
    </div>

<script>
        function delete_confirm() {
            if (!confirm("确认要删除？")) {
//                取消不变
                window.event.returnValue = false;
//                alert('notdel');
            }else {
//                处理数据
//                alert(window.location.search);
//                $urlpram=window.location.search;      //获得当前url网址
//                $id=window.location.search.substr(4);         //取得ID字段
                $id = {$data['id']};
//                $id=1;
//                alert($id);
                $.ajax({
//                    url:"{$next}",
                    url:"__CONTROLLER__/delete",
                    type:"POST",
                    data:{"id":$id},
//                    dataType:"ja/son",
                    error:function(){
                        alert('Error');
                    },
                    success:function(data){
                        //$a=$result;
//                        $b=json_decode(data);
//                        alert(2);
//                        $a = jsonPac
//                        alert(data);
//                      跳转到下个id
                        alert('删除成功');
                        window.location='{$next}';
                    }
                });
            }
        }
function all_choose(obj) {
    var button_text = $(obj).val();
    if( button_text == '全选'){
        $(".checkbox").prop("checked",true);
        $(obj).val('取消全选');
    }else if( button_text == '取消全选'){
        $(".checkbox").prop("checked",false);
        $(obj).val('全选');
    }else{}
}
</script>

<!--匹配地址-->
<script>
    $(function(){
        var areaMatch = document.getElementById('content_id');
        var areaMatchContent = areaMatch.innerHTML;
        var temp_start = document.getElementById('area_start_select');
        var temp_end = document.getElementById('area_end_select');
        $.getJSON('__PUBLIC__/freight_area.json',function(data){
//            var areaJsonObj = eval("(" + data + ")");
//            var areaJsonObj = data;
//            console.log(areaJsonObj);return;
            jQuery.each(data,function(k,val){
                if(val.short_name=='府谷'){
                    console.log(val.short_name);
                }

                if(areaMatchContent.indexOf(val.short_name)>= 0){
                    var select_start = document.createElement('span');
                    select_start.innerHTML="<label><input type='radio' value="+val.id+" name='area_start'>"+val.short_name+"</label>";
                    var select_end = document.createElement('span');
                    select_end.innerHTML="<label><input type='radio' value="+val.id+" name='area_end'>"+val.short_name+"</label>";
                    temp_start.appendChild(select_start);
                    temp_end.appendChild(select_end);
                }else{
                }
            });
        });
        //运费数字
        var temp_freight = document.getElementById('freight');
        //var result = areaMatchContent.match(/\d{1,}(?=\D)/g);
        var result = areaMatchContent.match(/\d+(\.\d+)?/g);

        if(result){
            $.each(result,function(k,val){
                if(val.length == 2 || val.length == 3){
                    var select_freight = document.createElement('span');
                    select_freight.innerHTML="<label><input type='radio' value="+val+" name='freight'>"+val+"</label>";
                    temp_freight.appendChild(select_freight);
                }else{}
            })
        }
    })
</script>

<script>
    $('#freight_submit').click(function(){
        var area_start_text = $('#area_start_text').val();
        var area_start = $('input[name=area_start]:checked').val();
        var area_end_text = $('#area_end_text').val();
        var area_end = $('input[name=area_end]:checked').val();
        var freight_text = $('#freight_text').val();
        var freight = $('input[name=freight]:checked').val();
//        var result_area_start,result_area_end,result_freight;
//        if(area_start_text){
//            result_area_start = area_start_text;
//        }else{
//            result_area_start = area_start;
//        }
//        if(area_end_text){
//            result_area_end = area_end_text;
//        }else{
//            result_area_end = area_end;
//        }
        area_start = parseInt(area_start)/100;
        area_end = parseInt(area_end)/100;
        var result_freight;
        if(freight_text){
            result_freight = freight_text;
        }else{
            result_freight = freight;
        }
        var message_id = {$data['id']};
        var phone_number = {$data['phone_number']};
        console.log(area_start);
//        console.log(result_area_start,result_area_end,result_freight,message_id);

//        console.log($('input[name=freight]:checked').parent('label').parent('span').siblings('span').eq(1).children('label').children('input').val());
//        return;
        $.ajax({
            type:"post",
            url:"{:U('DisplayMessages/freightSubmit')}",
            data:{
                message_id:message_id,
                phone_number:phone_number,
                area_start_id:area_start,
                area_start_name:area_start_text,
                area_end_id:area_end,
                area_end_name:area_end_text,
                freight_price:result_freight},
            success:function(data){
                $('#area_start_text').val('');
                $('#area_end_text').val('');
                $('#freight_text').val('');
            },
            error:function(XMLHttpRequest,textStatus,errorThrown){
            }
        });
    })
</script>


</body>

</html>