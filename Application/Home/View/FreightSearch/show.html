<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge，chrome=1">
    <!--<link rel="icon" href="../../favicon.ico">-->
    <title>运费查询</title>
    <link type="text/css" rel="stylesheet" href="__PUBLIC__/home/css/bootstrap.min.css"/>
    <link type="text/css" rel="stylesheet" href="__PUBLIC__/home/css/weui.min.css"/>
    <link type="text/css" rel="stylesheet" href="__PUBLIC__/home/css/mycss-v1107.css?v=1"/>
    <link type="text/css" rel="stylesheet" href="__PUBLIC__/home/css/city-picker.css"/>
    <script type="text/javascript" src="__PUBLIC__/home/js/jquery-2.2.4.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/home/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="__PUBLIC__/home/js/cookie.js"></script>
    <script type="text/javascript" src="__PUBLIC__/home/js/iscroll4.js"></script>
    <script type="text/javascript" src="__PUBLIC__/home/js/scroll-initial.js"></script>
    <script type="text/javascript" src="__PUBLIC__/home/js/ck_log.js"></script>
    <script type="text/javascript" src="__PUBLIC__/home/js/city-picker.data.js"></script>
    <script type="text/javascript" src="__PUBLIC__/home/js/city-picker2.js"></script>
    <script type="text/javascript" src="__PUBLIC__/home/js/loading.js"></script>
</head>
<style>
    .mynavbar:active {
        background-color: #fafafa;
    }

    .li-item {
        margin-bottom: 0.5em;
        background-color: white;
        border-radius: 5px;
        padding: 0.6em 0.6em 0 0.6em;
        box-shadow: 4px 4px 4px #e1e1e1;
    }

    .help-block {
        float: right;
        margin: 0 10px;
        font-size: 12px;
    }

    .area_start,.area_end{
        font-weight: 600;
    }

    p {
        margin-bottom: 0;
        font-size: 1.1em;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .detail {
        font-size: 0.8em
    }

    .arrow {
        padding: 3px;
        border: 1px solid transparent;
        border-radius: 50%
    }

    .divider {
        height: 1px;
        margin: 6px 0 0 0;
        overflow: hidden;
        background-color: #e5e5e5;
    }

    .function-bar {
        height: 2.8em;
        line-height: 2.8em;
        position: relative;
    }

    .time {
        margin-left: 0.5em;
        font-size: 12px;
    }

    .price {
        font-size: 1.2em;
        color: red;
        margin-right: 0.5em;
    }

    .detail-button {
        font-size: 12px;
        padding: 1px 3px;
        color: #04bfc6;
        border-color: #04bfc6;
        margin-right: 0.5em;
    }

    .feedback-button {
        font-size: 12px;
        padding: 2px 8px;
        color: #04bfc6;
        border-color: #04bfc6;
        border-radius: 0.7em;
        box-shadow: 2px 2px 2px #eee;
        margin-top: 0.6em;
    }

    #change_tag .text-center {
        width: 15%;
        position: relative;
        vertical-align: middle;
    }

    .triangle{
        width: 0;
        height: 0;
        border-top: 0.1em solid transparent;
        border-right: 1.1em solid transparent;
        border-bottom:0.2em solid #f30f0f;
        border-left: 0.1em solid transparent;
        margin-left: 40px;margin-top: 0.8em;
    }

    .rectangle{
        width: 0;
        height: 0;
        border-width: 1px 30px;
        border-style: solid;
        border-color: #f30f0f;
    }

    .triangle-bottom{
        width: 0;
        height: 0;
        border-top: 0.2em solid #f30f0f;
        border-right: 1.1em solid transparent;
        border-bottom:0.1em solid transparent;
        border-left: 0.1em solid transparent;
        margin-left: 40px;"
    }
</style>
<body>
<include file="Common:common"/>
<!--标签隐藏表单提交-->
<form name="tag_search" id="tag_search">
    <input type="hidden" name="area_start">
    <input type="hidden" name="area_start_name">
    <input type="hidden" name="area_start_val">
    <input type="hidden" name="area_end">
    <input type="hidden" name="area_end_name">
    <input type="hidden" name="area_end_val">
    <input type="hidden" name="page" id="page" value="1">
</form>
<!--导航标签-->
<div class="panel-title" style=";margin:0;padding: 0;background-color: white;display: block;">
    <div class="weui_navbar" style="position: relative;">
        <span id="start_tag" class="area-search"
              style="width: 42%;display: inline-block;line-height: 40px;font-size: 1.2em">
            <img src="__PUBLIC__/home/images/area_start_text.png" class=""
                 style="z-index: 2;position: absolute;height: 20px;top: 25%;left: 2%;">
            <input readonly type="text" data-toggle="city-picker"
                   name="search_area_start" id="area_start"
                   style="width: 100%;padding:6px 12px;" value=""
                   placeholder="起始地">
        </span>
        <div id="change_tag" class="text-center mynavbar area-search" >
            <div class="triangle"></div>
            <div class="rectangle"></div>
            <div class="triangle-bottom"></div>
        </div>
        <span id="end_tag" class="area-search"
              style="width: 43%;display: inline-block;line-height: 40px;font-size: 1.2em">
            <img src="__PUBLIC__/home/images/area_end_text.png" class=""
                 style="z-index: 2;position: absolute;height: 20px;top: 25%;left: 94%;;">
            <input readonly type="text" data-toggle="city-picker"
                   name="search_area_end" id="area_end"
                   style="width: 100%;padding:6px 12px;" value=""
                   placeholder="目的地">
        </span>
    </div>
</div>

<!--订单展示栏-->
<div id="wrapper" style="top: 50px;margin-left: 2.5%;">
    <div id="scroller">
        <div id="pullDown">
            <span class="pullDownIcon" style="float: left"></span>
            <span class="pullDownLabel" style="margin-left: -48px">下拉刷新...</span>
        </div>
        <div class="tab-content">
            <ul id="search" class="tab-pane active" style=";list-style-type: none">
                <if condition="$none eq 'empty'">
                    <div class="text-center" style="color: red">
                        <img src="__PUBLIC__/home/images/no_more_message.jpg" style="width: 100%;">
                        <!--查询不到消息啦哈哈哈哈！-->
                    </div>
                </if>
                <volist name="message" id="data">
                    <div class="li-item">
                        <div class="help-block time">{$data['record_time']|substr=0,10}</div>
                        <table class="text-center" style="width: 100%;">
                            <tr>
                                <td style="width: 45%">
                                    <!--<img src="__PUBLIC__/home/images/area_start_text.png" class="" style="height: 20px">-->
                                    <p class="highlight area_start">{$data['area_start_name']}</p>

                                    <p class="highlight detail area_start_detail">{$data['area_start_detail']}</p>
                                </td>
                                <td rowspan="1" style="width: 10%;color: #04bfc6;">
                                    <span>>>></span>
                                    <!--<span class="glyphicon glyphicon-arrow-right arrow"></span>-->
                                </td>
                                <td style="width: 45%">
                                    <p class="highlight area_end">{$data['area_end_name']}</p>

                                    <p class="highlight detail area_end_detail">{$data['area_end_detail']}</p>
                                </td>
                            </tr>
                        </table>
                        <div class="divider"></div>
                        <div class="function-bar">
                            <span class="price">¥{$data['freight_price']}元/吨</span>
                            <!--<span>-->
                            <!--<img src="__PUBLIC__/home/images/useless.png" style="height: 30px" onclick="asd(this)">-->
                            <!--<span style="color:#fb3e1e;margin-left: -3px" id="useful_count">123</span>-->
                            <!--</span>-->
                            <button class="btn btn-default feedback-button pull-right" data-toggle="modal"
                                    data-target="#feedback" data-whatever="{$data['id']}">
                                报错
                            </button>
                            <!--<button class="btn btn-default detail-button pull-right"-->
                            <!--onclick="window.location.href='__MODULE__/OwnerOrder/wx_order_detail/id/'+{$data['message_id']};">-->
                            <!--查看详情-->
                            <!--</button>-->
                        </div>
                    </div>
                </volist>
            </ul>
        </div>
        <div id="pullUp">
            <span class="pullUpIcon"></span>
            <span class="pullUpLabel" style="margin-left: -48px">上拉加载更多...</span>
        </div>
    </div>
</div>
<!--克隆-->
<div id="cloneObj" style="display: none;">
    <div class="li-item">
        <table class="text-center" style="width: 100%;">
            <tr>
                <td style="width: 45%">
                    <p class="highlight area_start">{$data['area_start_name']}</p>

                    <p class="highlight detail area_start_detail">{$data['area_start_detail']}</p>
                </td>
                <td rowspan="1" style="width: 10%">
                    <span>>>></span>
                </td>
                <td style="width: 45%">
                    <p class="highlight area_end">{$data['area_end_name']}</p>

                    <p class="highlight detail area_end_detail">{$data['area_end_detail']}</p>
                </td>
            </tr>
        </table>
        <div class="divider"></div>
        <div class="function-bar">
            <span class="time pull-left"></span>
            <button class="btn btn-default feedback-button pull-right" data-toggle="modal" data-target="#feedback"
                    data-whatever="{$data['id']}">
                报 错
            </button>
            <span class="price pull-right"></span>
            <!--<button class="btn btn-default detail-button pull-right"-->
                    <!--onclick="window.location.href='__MODULE__/OwnerOrder/wx_order_detail/id/'+{$data['message_id']};">-->
                <!--查看详情-->
            <!--</button>-->
        </div>
    </div>
</div>
<!-- Modal -->
<div class="modal fade bs-example-modal-lg" id="feedback" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" style="top:30%">
        <div class="modal-content">
            <div class="modal-header" style="border: none">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                    <span class="sr-only">Close</span>
                </button>
                <h5 class="modal-title" id="myModalLabel" style="color: grey;">错误信息提交</h5>
            </div>
            <div class="modal-body" style="padding-top: 0;padding-bottom: 0">
                <input id="freight_id" name="freight_id" type="hidden">
                <textarea name="feedback" id="feedback_input" class="form-control" rows="5"
                          placeholder="您可以输入实际运费，也可以直接提交" style="resize: none;width: 100%"></textarea>
            </div>
            <div class="modal-footer" style="border: none">
                <button id="feedback_submit" type="button" class="btn btn-primary"
                        style="border-color: #ccc;background-color: #04bfc6">提交
                </button>
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>
</body>
<!--载入读取上次标签-->
<script>
    $(function () {
        var temp_load = cookie('freight_search');
        var temp_load_obj = JSON.parse(cookie('freight_search'));
        console.log(temp_load_obj);
        jQuery.each(temp_load_obj,function(k,val){
            if(val.name == 'area_start'){
                if(val.value != '') {
                    $('input[name=area_start]').val(val.value);
                }else{}
            }
            else if(val.name == 'area_start_name'){
                if(val.value != ''){
                    $('input[name=area_start_name]').val(val.value);
                    $('#area_start_html').html(val.value);
                }else{}
            }
            else if (val.name == 'area_start_val') {
                if (val.value != '') {
                    $('input[name=area_start_val]').val(val.value);
                    var AreaArr_start = val.value.split('/');
                    $('#area_start').citypicker('destroy');
                    $('#area_start').citypicker({
                        province: AreaArr_start[0],
                        city: AreaArr_start[1],
                        district: AreaArr_start[2],
                    });
                } else {
                }
            }
            else if(val.name == 'area_end'){
                if(val.value != ''){
                    $('input[name=area_end]').val(val.value);
                }else{}
            }
            else if(val.name == 'area_end_name'){
                if(val.value != ''){
                    $('input[name=area_end_name]').val(val.value);
                    $('#area_end_html').html(val.value);
                }
            }
            else if (val.name == 'area_end_val') {
                if (val.value != '') {
                    $('input[name=area_end_val]').val(val.value);
                    var AreaArr_end = val.value.split('/');
                    $('#area_end').citypicker('destroy');
                    $('#area_end').citypicker({
                        province: AreaArr_end[0],
                        city: AreaArr_end[1],
                        district: AreaArr_end[2],
                    });
                } else {
                }
            }
        });
        console.log('form');
        console.log(JSON.stringify($('#tag_search').serializeArray()));
        setTimeout(requestAndRendering,1000);
    });
</script>
<!--功能抽离用于不同情况刷新页面-->
<script>
    function requestAndRendering() {
        //获取表单数据
        var area_start = $('input[name=area_start]').val();
        var area_start_name = $('input[name=area_start_name]').val();
        var area_end = $('input[name=area_end]').val();
        var area_end_name = $('input[name=area_end_name]').val();
        $.ajax({
            type: "post",
            url: "{:U('FreightSearch/show')}",
            data: {
                isAjax: 1,
                area_start: area_start,
                area_start_name: area_start_name,
                area_end: area_end,
                area_end_name: area_end_name
            },
            beforeSend: function () {
                $('#loadingToast').show();
            },
            success: function (data) {
                console.log('success');
                var jsonObj = eval("(" + data + ")");
                if (jsonObj.data.length == 0) {
                    $('#search').html("<div class='text-center'>" +
                            "<img src='__PUBLIC__/home/images/no_more_message.jpg' style='width: 100%;'>" +
                            "</div>");
                    return false;
                }
                $('#search').html('');
                $('#page').val(1);
                $.each(jsonObj.data, function (k, val) {
                    var tempObj = $("#cloneObj").children("div").clone(true);
                    tempObj.find('.time').html(showTime(val.record_time));
                    tempObj.find('.area_start').html(areaStrSplit(val.area_start_merger_name));
                    tempObj.find('.area_start_detail').html(val.area_start_name+' '+(val.area_start_detail?val.area_start_detail:''));
                    tempObj.find('.area_end').html(areaStrSplit(val.area_end_merger_name));
                    tempObj.find('.area_end_detail').html(val.area_end_name+' '+(val.area_end_detail?val.area_end_detail:''));
                    tempObj.find('.price').html(val.freight_price + '元/吨');
                    tempObj.find('.feedback-button').attr('data-whatever', val.id);
//                    tempObj.find('.detail-button').attr('onclick', "window.location.href='__MODULE__/OwnerOrder/wx_order_detail/id/" + val.message_id + "';");
                    tempObj.appendTo("#search");
                });
                myScroll.refresh();
//                refresh_hl();
            },
            complete: function () {
                $('#loadingToast').hide();
            }
        });
        myScroll.refresh();
        flag = true;
    }
</script>
<!--地址选择-->
<script>
    //点击地址选择标签
    $(document).on('render_flag', function () {
        console.log('rendering rendering');
        var area_tag = cookie('area_tag');
        var input, areaArr, area_start_name, area_start_id, area_end_name, area_end_id;
        var area_start, area_end;
        if (area_tag == 'start') {
            ck_log("click", "选择起始地");
            //取起始地的值
            input = $('#area_start');
            areaArr = input.val().split('/');
            area_start_name = areaArr[areaArr.length - 1];
            area_start_id = input.data('citypicker').getCode();
            //更新表单对应值
            $('input[name=area_start]').val(area_start_id);
            $('input[name=area_start_name]').val(area_start_name);
            $('input[name=area_start_val]').val(input.val());
            //更新页面cookie
            cookie('freight_search', JSON.stringify($('#tag_search').serializeArray()));
            //ajax请求并渲染页面
            requestAndRendering();
        } else if (area_tag == 'end') {
            ck_log("click", "选择目的地");
            //取目的地的值
            input = $('#area_end');
            areaArr = input.val().split('/');
            area_end_name = areaArr[areaArr.length - 1];
            area_end_id = input.data('citypicker').getCode();
            //更新表单对应值
            $('input[name=area_end]').val(area_end_id);
            $('input[name=area_end_name]').val(area_end_name);
            $('input[name=area_end_val]').val(input.val());
            //更新页面cookie
            cookie('freight_search', JSON.stringify($('#tag_search').serializeArray()));
            //ajax请求并渲染页面
            requestAndRendering();
        } else {
        }
    });
    //起始地
    $('#start_tag').click(function () {
        console.log('start_area click');
        cookie('area_tag', 'start');
    });
    //目的地
    $('#end_tag').click(function () {
        console.log('end_area click');
        cookie('area_tag', 'end');
    });
</script>
<!--滚动功能-->
<script>
    var load_state = 0;
    var flag = true;
    /**下拉刷新 （自定义实现此方法）
     *myScroll.refresh(); // 数据加载完成后，调用界面更新方法
     */
    function pullDownAction() {
        console.log('down', flag);
        var area_start = $('input[name=area_start]').val();
        var area_start_name = $('input[name=area_start_name]').val();
        var area_end = $('input[name=area_end]').val();
        var area_end_name = $('input[name=area_end_name]').val();
        $.ajax({
            type: "post",
            url: "{:U('FreightSearch/show')}",
            data: {
                isAjax: 1,
                area_start: area_start,
                area_start_name: area_start_name,
                area_end: area_end,
                area_end_name: area_end_name
            },
            success: function (data) {
                console.log('success', flag);
                var jsonObj = eval("(" + data + ")");
                console.log(jsonObj, jsonObj.data, jsonObj.data.length);
                if (jsonObj.data.length == 0) {
                    $('#search').html("<div class='text-center'>" +
                            "<img src='__PUBLIC__/home/images/no_more_message.jpg' style='width: 100%;'>" +
                            "</div>");
                    return false;
                }
                $('#search').html('');
                $('#page').val(1);
                $.each(jsonObj.data, function (k, val) {
                    var tempObj = $("#cloneObj").children("div").clone(true);
                    tempObj.find('.time').html(showTime(val.record_time));
                    tempObj.find('.area_start').html(areaStrSplit(val.area_start_merger_name));
                    tempObj.find('.area_start_detail').html(val.area_start_name+' '+(val.area_start_detail?val.area_start_detail:''));
                    tempObj.find('.area_end').html(areaStrSplit(val.area_end_merger_name));
                    tempObj.find('.area_end_detail').html(val.area_end_name+' '+(val.area_end_detail?val.area_end_detail:''));
                    tempObj.find('.price').html(val.freight_price + '元/吨');
                    tempObj.find('.feedback-button').attr('data-whatever', val.id);
//                    tempObj.find('.detail-button').attr('onclick', "window.location.href='__MODULE__/OwnerOrder/wx_order_detail/id/" + val.message_id + "';");
                    tempObj.appendTo("#search");
                });
                myScroll.refresh();
//                refresh_hl();
                flag = true;
            }
        });
        myScroll.refresh();//数据加载完成后，调用界面更新方法  Remember to refresh when contents are loaded (ie: on ajax completion)
    }
    /**滚动翻页 （自定义实现此方法）
     *myScroll.refresh(); // 数据加载完成后，调用界面更新方法
     */
    function pullUpAction() {
        if (load_state == 1) {
            return false;
        } else {
            load_state = 1;
            console.log('up', flag);
            var a = $('#tag_search').serialize();
            var area_start = $('input[name=area_start]').val();
            var area_start_name = $('input[name=area_start_name]').val();
            var area_end = $('input[name=area_end]').val();
            var area_end_name = $('input[name=area_end_name]').val();
            var page = $('#page').val();
            console.log('cur_page', page);
            var request_page = parseInt(page) + 1;
            console.log('rq_page', request_page);
            $.ajax({
                type: "post",
                url: "{:U('FreightSearch/show_more')}",
                data: {
                    area_start: area_start,
                    area_start_name: area_start_name,
                    area_end: area_end,
                    area_end_name: area_end_name,
                    page: request_page
                },
                success: function (data) {
                    console.log('success', flag);
                    var jsonObj = eval("(" + data + ")");
                    console.log(jsonObj, jsonObj.data, jsonObj.data.length);
                    $.each(jsonObj.data, function (k, val) {
                        var tempObj = $("#cloneObj").children("div").clone(true);
                        tempObj.find('.time').html(showTime(val.record_time));
                        tempObj.find('.area_start').html(areaStrSplit(val.area_start_merger_name));
                        tempObj.find('.area_start_detail').html(val.area_start_name+' '+(val.area_start_detail?val.area_start_detail:''));
                        tempObj.find('.area_end').html(areaStrSplit(val.area_end_merger_name));
                        tempObj.find('.area_end_detail').html(val.area_end_name+' '+(val.area_end_detail?val.area_end_detail:''));
                        tempObj.find('.price').html(val.freight_price + '元/吨');
                        tempObj.find('.feedback-button').attr('data-whatever', val.id);
//                        tempObj.find('.detail-button').attr('onclick', "window.location.href='__MODULE__/OwnerOrder/wx_order_detail/id/" + val.message_id + "';");
                        tempObj.appendTo("#search");
                    });
                    if (jsonObj.end_tag == 'end') {
                        if (flag) {
                            var div = document.createElement('div');
                            div.style.cssText = 'margin-top:2.5%;color:red;text-align:center';
                            div.innerHTML = '小矿查不到更多消息啦!';
                            document.getElementById('search').appendChild(div);
                            flag = false;
                        }
                        $('#page').val(jsonObj.page);
                    } else if (jsonObj.end_tag == 'continue') {
                        $('#page').val(jsonObj.page);
                    }
                    load_state = 0;
                    myScroll.refresh();
                }
            });
            //============================================
            myScroll.refresh(); // 数据加载完成后，调用界面更新方法 Remember to refresh when contents are loaded (ie: on ajax completion)
        }
    }
</script>
<!--点赞功能-->
<script>
    function asd(obj) {
        var count = parseInt($(obj).siblings('span').html());
        if ($(obj).attr('src') == "__PUBLIC__/home/images/useless.png") {
            $(obj).attr("src", "__PUBLIC__/home/images/usefull.png");
//            $.ajax({
//                type: "post",
//                url: "{:U('FreightSearch/VoteCount')}",
//                data: {message_id:id,vote: 'Upvote',count:count},
//                success: function (data) {
//
//                },
//                error: function (XMLHttpRequest, textStatus, errorThrown) {
//                }
//            });
            count += 1;
            $(obj).siblings('span').html(count);
            console.log(count);

        } else {
            $(obj).attr("src", "__PUBLIC__/home/images/useless.png");
            count -= 1;
            $(obj).siblings('span').html(count);
            console.log(count);
        }
    }
</script>
<!--报错功能-->
<script>
    //自动对焦
    $('#feedback').on('shown.bs.modal', function (event) {
        ck_log('click_feedback','运费按钮点击');
        $('#feedback_input').focus();
        var button = $(event.relatedTarget);
        var recipient = button.data('whatever');
        var modal = $(this);
//        modal.find('.modal-title').text('New message to ' + recipient);
        modal.find('.modal-body input').val(recipient)
    });
    $('#feedback_submit').click(function () {
        var freight_id = $('#freight_id').val();
        var content = $('#feedback_input').val();
        var feedback_string = '运费ID为' + freight_id + "的报错信息:" + content;
        $.ajax({
            type: "post",
            url: "{:U('Feedback/feedback_action')}",
            data: {
                contact: freight_id,
                feedback: feedback_string
            },
            success: function (data) {
                $('#feedback').modal('hide');
            }
        });
    });
</script>
<!--处理地址全称字符串-->
<script>
    function areaStrSplit(areaStr) {
        if (areaStr == null || areaStr == ''){
            return false;
        }
        var areaArr = areaStr.split(',');
        if(areaArr[3]){
            areaStr = areaArr[2]+' '+areaArr[3];
        }else if(areaArr[2]){
            areaStr = areaArr[2];
        }else{
            areaStr = areaArr[1];
        }
        return areaStr;
    }
</script>
<!--判断发布时间并处理时间字符串-->
<script>
    function showTime(timeStr) {
        if (timeStr == null || timeStr == '') {
            return;
        }
        var end_str = (timeStr).replace(/-/g, "/");
        var class_time = new Date(end_str);   //将时间字符串转换为时间.
        var now_time = new Date();
        var totalSecs = (now_time - class_time) / 1000;   //获得两个时间的总毫秒数. 靠前的就调换再减。
        var days = Math.floor(totalSecs / 3600 / 24);
        var hours = Math.floor((totalSecs - days * 24 * 3600) / 3600);
        var mins = Math.floor((totalSecs - days * 24 * 3600 - hours * 3600) / 60);
        var secs = Math.floor((totalSecs - days * 24 * 3600 - hours * 3600 - mins * 60));
        if (days <= 7) {
            if (days != 0 || days < 0) {
                timeStr = days + "天前";
            } else if (hours == 0 && mins == 0) {
                timeStr = "刚刚发布";
            } else if (hours == 0 && mins != 0) {
                timeStr = mins + "分前";
            } else if (hours != 0) {
                timeStr = hours + "小时前";
            }
        } else {
            timeStr = timeStr.substr(0,10);
        }
        return timeStr;
    }
</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    wx.config({
        debug: false,
        appId: '{$signPackage["appId"]}',
        timestamp: {$signPackage["timestamp"]},
        nonceStr: '{$signPackage["nonceStr"]}',
        signature: '{$signPackage["signature"]}',
        jsApiList: [
            // 所有要调用的 API 都要加到这个列表中
            'onMenuShareTimeline', 'onMenuShareAppMessage',
            'hideOptionMenu',
            'showOptionMenu',
            'hideMenuItems',
            'showMenuItems',
            'hideAllNonBaseMenuItem',
            'showAllNonBaseMenuItem'
        ]
    });
    wx.ready(function () {
        // 在这里调用 API
        // 分享到朋友圈
        var url = window.location.href;
        wx.onMenuShareTimeline({
            title: '超矿平台运费查询', // 分享标题
            link: url, // 分享链接
            imgUrl: 'http://www.xuncl.com/cjkzy_icon.png', // 分享图标
            success: function () {
            },
            cancel: function () {
            }
        });

        //分享给朋友
        wx.onMenuShareAppMessage({
            title: '超矿平台运费查询', // 分享标题
            desc: '超级矿资源官方认证的运费查询系统，数据精确可靠', // 分享描述
            link: "http://www.xuncl.com/index.php/Home/FreightSearch/show", // 分享链接
            imgUrl: 'http://www.xuncl.com/cjkzy_icon.png', // 分享图标
            type: '', // 分享类型,music、video或link，不填默认为link
            dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function () {
            },
            cancel: function () {
            }
        });
    });
</script>